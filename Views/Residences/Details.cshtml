@model AirBB.Models.DomainModels.Residence
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = @Model.Name;
}

<div class="container mt-4 mb-5">

    <img src="~/images/@Model.ResidencePicture"
         class="img-fluid rounded shadow-sm mb-4"
         style="width:100%; max-height:300px; object-fit:cover;" />

    <div class="card shadow-sm p-4 rounded-4">

        <h3 class="fw-bold">@Model.Name</h3>

        <p class="text-muted mb-2">
            @Model.Location?.City • Sleeps @Model.GuestNumber • 
            @Model.BedroomNumber br / @Model.BathroomNumber bath
        </p>

        <p class="fw-bold fs-5 mb-4">
            $@Model.PricePerNight <span class="text-muted">/ night</span>
        </p>


        <form asp-controller="Reservation" asp-action="Reserve" method="post">
            <input type="hidden" name="ResidenceId" value="@Model.ResidenceId" />

            <label class="fw-bold">Check-in</label>
            <input type="text"
                   id="startDate"
                   name="StartDate"
                   class="form-control mb-3"
                   placeholder="mm-dd-yyyy"
                   autocomplete="off"
                   inputmode="none"
                   readonly
                   required />

            <label class="fw-bold">Check-out</label>
            <input type="text"
                   id="endDate"
                   name="EndDate"
                   class="form-control mb-4"
                   placeholder="mm-dd-yyyy"
                   autocomplete="off"
                   inputmode="none"
                   readonly
                   required />

            <div class="d-flex gap-3">
                <button type="submit" class="btn btn-success flex-fill">Reserve</button>
                <a href="/Home" class="btn btn-secondary flex-fill">Back to Home</a>
            </div>
        </form>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger mt-3">
                @TempData["Error"]
            </div>
        }

    </div>
</div>

<script>
    function setup(id) {
        const input = document.getElementById(id);

        input.addEventListener("focus", function () {
            this.readOnly = false;
            this.type = "date";
        });

        input.addEventListener("change", function () {
            const original = this.value;
            if (original) {
                const p = original.split("-");
                this.type = "text";
                this.readOnly = false;
                this.value = `${p[1]}-${p[2]}-${p[0]}`;
            }
        });

        input.addEventListener("blur", function () {
            if (!this.value) {
                this.type = "text";
                this.readOnly = true;
            }
        });

        
        input.type = "text";
    }

    setup("startDate");
    setup("endDate");
</script>
